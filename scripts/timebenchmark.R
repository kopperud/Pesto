## load libraries

library(TESS)
library(BDS)
library(ggplot2)


## The model
lambda <- c(0.007213066117787695, 0.02513926987812432, 0.05695189948393688, 0.11956344947502529, 0.27086568502054126, 0.9440320448002322, 0.007213066117787695, 0.02513926987812432, 0.05695189948393688, 0.11956344947502529, 0.27086568502054126, 0.9440320448002322, 0.007213066117787695, 0.02513926987812432, 0.05695189948393688, 0.11956344947502529, 0.27086568502054126, 0.9440320448002322, 0.007213066117787695, 0.02513926987812432, 0.05695189948393688, 0.11956344947502529, 0.27086568502054126, 0.9440320448002322, 0.007213066117787695, 0.02513926987812432, 0.05695189948393688, 0.11956344947502529, 0.27086568502054126, 0.9440320448002322, 0.007213066117787695, 0.02513926987812432, 0.05695189948393688, 0.11956344947502529, 0.27086568502054126, 0.9440320448002322)
mu <- c(0.0036065330588938476, 0.0036065330588938476, 0.0036065330588938476, 0.0036065330588938476, 0.0036065330588938476, 0.0036065330588938476, 0.012569634939062163, 0.012569634939062163, 0.012569634939062163, 0.012569634939062163, 0.012569634939062163, 0.012569634939062163, 0.028475949741968435, 0.028475949741968435, 0.028475949741968435, 0.028475949741968435, 0.028475949741968435, 0.028475949741968435, 0.059781724737512636, 0.059781724737512636, 0.059781724737512636, 0.059781724737512636, 0.059781724737512636, 0.059781724737512636, 0.13543284251027063, 0.13543284251027063, 0.13543284251027063, 0.13543284251027063, 0.13543284251027063, 0.13543284251027063, 0.47201602240011603, 0.47201602240011603, 0.47201602240011603, 0.47201602240011603, 0.47201602240011603, 0.47201602240011603)
eta <- 0.1




## Simulate phylogenies of different size

phys <- list()
ntaxa <- c(10, 20, 40, 60, 80, 160, 320)

phys <- list()
for (i in seq_along(ntaxa)){
  phy <- TESS::tess.sim.taxa.age(1, ntaxa[i], 2.0, 1.0, 0.5)[[1]]
  phys[[i]] <- phy
}

## Test how much time we need to execute program
times <- list()
for (i in seq_along(phys)){
  t1 <- Sys.time()
  res <- birth_death_shift(phys[[i]], lambda, mu, eta)
  t2 <- Sys.time()
  cat(".")
  times[[i]] <- t2 - t1
};cat("\n")

df <- tibble("times" = unlist(times),
             "ntaxa" = ntaxa)



ggplot(df, aes(x = ntaxa, y = times)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm")






